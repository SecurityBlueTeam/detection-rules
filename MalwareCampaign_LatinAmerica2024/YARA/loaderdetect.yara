import "hash"

rule LatinAmerica_MalwareCampaign_Loader
{
    meta:
        description = "YARA rule for detecting the dropper used in Latin America Malware Campaign"
        author = "Security Blue Team"
        date = "2024-09-XX"
        hash = "236a03c3345f710b5d137e9ae3298847ed83e61de998f5b600ac440cccc4fc23"

    strings:
        $s1 = "SoftwareDetector.dll" ascii wide
        $s2 = "OnDetectSoftware" ascii wide
        $s3 = "Secur32.dll" ascii wide
        $s4 = "GetLastError" ascii wide
        $s5 = "LoadLibraryW" ascii wide
        $s6 = "GetProcAddress" ascii wide
        $s7 = "FreeLibrary" ascii wide
        $s8 = "ROOT\\SecurityCenter2" ascii wide
        $s9 = "SELECT * FROM AntiVirusProduct" ascii wide
        $s10 = "Detected antivirus :" ascii wide
        $s11 = "WindowsAzureGuestAgent.exe" ascii wide
        $s12 = "function Sleep(seconds)" ascii wide
        $s13 = "var StartTime = new Date();" ascii wide
        $s14 = "while (datet < (seconds * 1000))" ascii wide
        $s15 = "var EndTime = new Date();" ascii wide

    condition:
        filesize > 5MB and // Ensure the file is larger than 5MB
        all of ($s*) and // Match all strings
        hash.sha256(0, filesize) == "236a03c3345f710b5d137e9ae3298847ed83e61de998f5b600ac440cccc4fc23" // Ensure the hash matches
}
